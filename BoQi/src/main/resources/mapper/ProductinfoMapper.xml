<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yc.boqi.mapper.ProductinfoMapper" >
	<!-- 获取商城主页的所有种类的前8个商品 -->
	<select id="findTop8OfProductByLei" resultType="Top8ProductinfoBean">
		select *from(select t.*,row_number() over (partition by t.fid order by t.proid desc) RN from 
		(select p.*,s.fid fid from productinfo p,secondmenu s where p.tid=s.tid) t) where  RN<![CDATA[<]]>=8
	</select>
	<!-- 通过种类来获取商品 -->
	<select id="findTypePro" parameterType="map" resultType="Productinfo">
		select * from(select a.*,rownum rn from (select proid,proname,nature,b.brandname,s.tname,suitpet,pictrue,
		promarprice,bqpri,prosales,prointro,inventory,p.status from productinfo p,brand b,secondmenu s where 
		p.tid=s.tid and b.brandid=p.brandid and  suitpet=#{petType} and p.status in(0,1) order by proid) a where 
		rownum<![CDATA[<]]>=#{yi}) b where rn<![CDATA[>]]>#{er}
	</select>
	<!-- 获取一个种类的数量 -->
	<select id="ProTotal" parameterType="string" resultType="int">
		select count(proid)  from productinfo where suitpet=#{type}
	</select>
	<!-- 添加商品 -->
	<insert id="addProduct" parameterType="Productinfo">
		insert into productinfo values(seq_proid.nextval,#{proname},#{nature},#{brandid},#{tid},#{suitpet}
		,#{pictrue},#{promarprice},#{bqpri},#{prosales},#{prointro},#{inventory},#{status},null,null)
	</insert>
	<select id="searchPro" parameterType="map" resultType="Productinfo">
		select * from(select a.*,rownum rn from (select proid,proname,nature,b.brandname,
		s.tname,suitpet,pictrue,promarprice,bqpri,prosales,prointro,inventory,p.status 
		from productinfo p
		left join brand b on p.brandid=b.brandid
		left join secondmenu s on p.tid=s.tid where proname like '%${info}%' or nature like '%${info}%' or brandname
		like '%${info}%' or tname like '%${info}%' or suitpet like '%${info}%' or prointro like '%${info}%'
		order by #{order}) 
		a where rownum<![CDATA[<]]>=${one}) b where rn<![CDATA[>]]>${two}
	</select>
</mapper>